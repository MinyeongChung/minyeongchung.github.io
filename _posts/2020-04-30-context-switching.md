---
layout: post
title: context switching
categories: [hardware]
---

도대체 컨텍스트 스위칭은 어떻게 일어나는 것인가?

가장 먼저 인터럽트가 걸린다. 인터럽트가 걸리는 순간에 인터럽트 처리 루틴으로 넘어가게 된다. 그런데 넘어가는 순간에 eip가 바뀌기 때문에 하드웨어적으로 이를 스택이 밀어넣어준다. 그리고 psw 역시 인터럽트 과정에서 바뀌기 때문에 이를 하드웨어 적으로 푸쉬해준다.

그런 후에, 인터럽트 서비스 루틴은 인터럽트 리퀘스트 넘버를 확인하고, 이를 통해서 테이블 서치를 하고, 이에 맞는 인터럽트 서비스 루틴을 부른다.

이 과정에서 context switching 이 발생하게 되면 기존에 존재하는 레지스터들을 스택에 밀어넣는다. 그런 다음에 최종적 스택 포인터를 PCB의 sp에 저장한다. 그런 다음 새로운 PCB에서 sp를 가져오고, 이를 반대로 반복한다.
