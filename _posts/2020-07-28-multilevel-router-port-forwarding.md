---
layout: post
title: multilevel router port forwarding
categories: []
---

집에 공유기(가정용 라우터)를 여러대를 연결했다고 하면, 포트 포워딩에 조금더 많은 설정을 해주어야 한다. 만약 설치된 라우터가 다음과 같이 되어 있다고 하자.

인터넷 --- 공유기 1 --- 공유기 2 --- 컴퓨터

만약 내가 컴퓨터에 서버를 켜놨다면, 포트포워딩을 두번을 해주어야 한다. 각 개체(entity, 이 경우에는 컴퓨터, 공유기 등등)은 모두 각자 공인 외부 ip가 존재하고, 내부 ip가 따로 존재한다. 그래서 만약 `iptime` 을 사용하게 된다면, 다음과 같은 주소를 가질 것이다.

인터넷 --- 123.456.789(외부 ip) 공유기 1 192.168.0.1(내부 ip) --- 192.168.0.2(외부 ip) 공유기 2 192.168.1.1(내부 ip) --- 192.168.1.2 컴퓨터

이렇게 되면, 가장 외부 ip인 123.456.789에서 컴퓨터까지 접속하기 위해서는 공유기를 두 개를 거쳐야 하기 때문에 두 번의 포트 포워딩이 필요하다. 따라서 내가 123.456.789 의 1234 포트를 컴퓨터의 4321 포트에 연결하고 싶으면 다음과 같이 하면 된다.

첫 번째 공유기에서 123.456.789:1234 를 공유기 1 입장에서 공유기 2에게 부여한 ip 주소의 포트로 연결해준다. 이 경우 192.168.0.2:7777 로 연결해준다. 그렇게 한 다음에, 두 번째 공유기에서 192.168.0.2:7777 을 192.168.1.2:4321 에 연결해준다.

가장 중요한건, 연결을 할 때에는 그 개체에게 부여된 공인 ip 주소를 사용해야 한다는 것이다. 특히 중간에 끼어 있는 공유기 2 같은 경우는 외부 ip 주소와 내부 ip 주소가 다르기 때문에, 공유기 1에서 공유기 2 를 연결할 때 공유기 2의 내부 ip 주소를 사용하면 안된다는 것이다.
